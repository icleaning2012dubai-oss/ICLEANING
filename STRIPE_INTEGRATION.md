# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Stripe —Å –∫–æ—Ä–∑–∏–Ω–æ–π

## –û–±–∑–æ—Ä
–£—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω Stripe –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–µ–π –≤ –∫–æ—Ä–∑–∏–Ω–µ. –ö–ª–∏–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å –º–µ–∂–¥—É –æ–ø–ª–∞—Ç–æ–π –Ω–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–æ–π –∫–∞—Ä—Ç–æ–π —á–µ—Ä–µ–∑ Stripe.

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- `stripe` - —Å–µ—Ä–≤–µ—Ä–Ω—ã–π SDK –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Stripe API
- `@stripe/stripe-js` - –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π SDK –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Stripe.js

### 2. API Routes

#### `/api/create-checkout-session` (POST)
–°–æ–∑–¥–∞–µ—Ç Stripe Checkout Session –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã.
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∫–æ—Ä–∑–∏–Ω—ã –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–µ
- –°–æ–∑–¥–∞–µ—Ç line items –¥–ª—è Stripe
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ Stripe Checkout

#### `/api/webhooks/stripe` (POST)
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook —Å–æ–±—ã—Ç–∏—è –æ—Ç Stripe:
- `checkout.session.completed` - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
- `payment_intent.succeeded` - —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
- `payment_intent.payment_failed` - –Ω–µ—É–¥–∞—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞

#### `/api/checkout-session` (GET)
–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Stripe —Å–µ—Å—Å–∏–∏ –ø–æ ID –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É—Å–ø–µ—Ö–∞.

### 3. –°—Ç—Ä–∞–Ω–∏—Ü—ã

#### `/checkout/page.tsx`
–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Stripe
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã –∫–∞—Ä—Ç–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Stripe Checkout
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞

#### `/checkout/success/page.tsx`
–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Stripe
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ
- –û—á–∏—â–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 4. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è:
- –°–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö –æ–ø–ª–∞—Ç—ã
- –°—Ç–∞—Ç—É—Å–æ–≤ –æ–ø–ª–∞—Ç—ã
- –¢–µ–∫—Å—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É—Å–ø–µ—Ö–∞
- –í–æ –≤—Å–µ—Ö 3 —è–∑—ã–∫–∞—Ö: –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, —Ä—É—Å—Å–∫–∏–π, –∞—Ä–∞–±—Å–∫–∏–π

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á–∏ Stripe

–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [https://dashboard.stripe.com/register](https://dashboard.stripe.com/register) –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç.

–ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ [https://dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys):
- **Publishable key** - –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏
- **Secret key** - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏

### 2. –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `.env.local`

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env.local` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ:

```env
# Stripe Keys
STRIPE_SECRET_KEY=sk_test_–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_–≤–∞—à_–ø—É–±–ª–∏—á–Ω—ã–π_–∫–ª—é—á
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: 
- –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–∏ –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `sk_test_` –∏ `pk_test_`
- –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ live –∫–ª—é—á–∏: `sk_live_` –∏ `pk_live_`

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook (–¥–ª—è production)

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ–±—ã—Ç–∏—è—Ö –æ–ø–ª–∞—Ç—ã:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [https://dashboard.stripe.com/webhooks](https://dashboard.stripe.com/webhooks)
2. –ù–∞–∂–º–∏—Ç–µ "Add endpoint"
3. –í–≤–µ–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ webhook: `https://your-domain.com/api/webhooks/stripe`
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è:
   - `checkout.session.completed`
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Signing secret** –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`:

```env
STRIPE_WEBHOOK_SECRET=whsec_–≤–∞—à_webhook_secret
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Stripe CLI:
```bash
brew install stripe/stripe-cli/stripe
```

–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç:
```bash
stripe login
```

–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å—Ç–µ webhook –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä:
```bash
stripe listen --forward-to localhost:3000/api/webhooks/stripe
```

–≠—Ç–æ –¥–∞—Å—Ç –≤–∞–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π webhook secret - –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ `.env.local`.

#### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

‚úÖ **–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:**
- –ù–æ–º–µ—Ä: `4242 4242 4242 4242`
- –î–∞—Ç–∞: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞
- CVC: –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã
- –ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å: –ª—é–±–æ–π

‚ùå **–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞:**
- –ù–æ–º–µ—Ä: `4000 0000 0000 0002`

üîê **–¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- –ù–æ–º–µ—Ä: `4000 0025 0000 3155`

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç: [https://stripe.com/docs/testing](https://stripe.com/docs/testing)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Å –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:
   - **–ù–∞–ª–∏—á–Ω—ã–º–∏** - –æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ
   - **–ö–∞—Ä—Ç–æ–π** - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Stripe Checkout
5. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–∞—Ä—Ç—ã:
   - –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ Stripe —Å–µ—Å—Å–∏—è
   - –ü—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Stripe
   - –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤–µ—Ä–Ω–µ—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—Ö–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env.local` (–Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ git)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π Stripe Checkout
- ‚úÖ Webhook –∑–∞—â–∏—â–µ–Ω –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–∞—à —Å–µ—Ä–≤–µ—Ä

## –í–∞–ª—é—Ç–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **AED** (–¥–∏—Ä—Ö–∞–º –û–ê–≠).

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞–ª—é—Ç—É, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª [`/api/create-checkout-session/route.ts`](app/api/create-checkout-session/route.ts):

```typescript
currency: 'aed', // –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—É—é –≤–∞–ª—é—Ç—É (usd, eur, gbp, –∏ —Ç.–¥.)
```

## Production —á–µ–∫–ª–∏—Å—Ç

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production:

- [ ] –ó–∞–º–µ–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –Ω–∞ live –∫–ª—é—á–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –Ω–∞ production –¥–æ–º–µ–Ω–µ
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–ø–ª–∞—Ç—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–π—Ç–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Stripe Dashboard
- [ ] –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ø–æ—Ä–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (disputes)
- [ ] –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ webhook —Å–æ–±—ã—Ç–∏–π

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### TODO (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ Stripe
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—É—é —É–±–æ—Ä–∫—É

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Stripe: [https://stripe.com/docs](https://stripe.com/docs)
–ü–æ–¥–¥–µ—Ä–∂–∫–∞: [https://support.stripe.com](https://support.stripe.com)

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Stripe SDK —Å –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.
